<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/0.26.0/axios.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/qs/6.10.3/qs.min.js"></script>
</head>
<style>
html,body {
    height: 100%;
}
#note-view {
    height: 100%;
}
#note-view textarea{
    resize: none;
    border: 1px black;
    height: 98%;
    width: 99%;
}
</style>

<body>
    <div id="note-view">
        <label for="note"></label><textarea autofocus id="note"></textarea>
    </div>


    <script >
        let label;
        window.onload = function () {

            console.log(getHeaders());
            label = getQueryVariable("label");
            if (!label){
                getLabel();
            }

            const textArea = document.getElementById("note");
            textArea.addEventListener('input',function () {
                console.log(this.value);
                createNote(this.value);
            })
        }


        function createNote(content){
            const qs = Qs;
            axios({
                url: 'http://127.0.0.1:8081/createNote',
                method: 'post',
                data: qs.stringify({content: content,label:label})
            }).then(function (response){
                console.log(response)
            }).catch(function (error){
                console.log(error)
            })
        }

        function createNote2(content){
            axios({
                url: 'http://127.0.0.1:8081/createNote2',
                method: 'post',
                data: {
                    content: content
                }
            }).then(function (response){
                console.log(response)
            }).catch(function (error){
                console.log(error)
            })
        }

        function getLabel(){
            axios({
                url: 'http://127.0.0.1:8081/getLabel',
                method: 'get',
            }).then(function (response){
                console.log(response)
                label = response.data;
            }).catch(function (error){
                console.log(error)
            })
        }

        function getQueryVariable(variable) {
            const query = window.location.search.substring(1);
            const vars = query.split("&");
            for (let i = 0; i < vars.length; i++) {
                const pair = vars[i].split("=");
                if (pair[0] === variable) { return pair[1]; }
            }
            return false;
        }



        function getHeaders(){
            var req = new XMLHttpRequest();
            req.open('GET', document.location.href, false);
            req.send(null);
            var headerArr = req.getAllResponseHeaders().split('\n');
            var headers = {};
            headerArr.forEach(item=>{
                if(item!==''){
                    var index = item.indexOf(':');
                    var key = item.slice(0,index);
                    var value = item.slice(index+1).trim();
                    headers[key] = value
                    console.log(key+":"+value)
                }

            })
            return headers
        }


    </script>
</body>
</html>